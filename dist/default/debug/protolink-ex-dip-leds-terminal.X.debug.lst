CCS PCH C Compiler, Version 5.081, 13314               21-Ene.-26 12:20

               Filename:   C:\Users\josep\MPLABXProjects\protolink-ex-dip-leds-terminal.X\dist\default\debug\protolink-ex-dip-leds-terminal.X.debug.lst

               ROM used:   202 bytes (0%)
                           Largest free fragment is 65536
               RAM used:   7 (0%) at main() level
                           7 (0%) worst case
               Stack used: 0 locations
               Stack size: 2561

*
00600:  GOTO   0630
.................... #import(file="build/default/debug/main.o") 
....................  
....................  
.................... /*  
....................  * File:   excore.h 
....................  * Author: Arturo Gasca 
....................  * Galio Electronics 
....................  * Excore V1 Pinout 
....................  * 
....................  * Created on 12 de noviembre de 2025, 08:25 PM 
....................  */ 
....................  
.................... #ifndef PROTOLINK_H 
.................... #define	PROTOLINK_H 
....................  
.................... #include <18F67K40.h>          // Ajusta tu MCU 
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
.................... #device ADC = 10 
.................... #fuses HS 
.................... #use delay(crystal=16mhz,clock=64mhz) 
....................  
.................... /*USER BUTTON AND LEDS*/ 
.................... #define USER        PIN_B2  //Interruption 2 
.................... #define LED1        PIN_D0 
....................  
....................  
.................... /*HEADER RS232*/ 
.................... #define TX_2        PIN_G1  //Puerto 1 UART2 
.................... #define RX_2        PIN_G2 
.................... #define TX_3        PIN_E0  //Puerto 2 UART3 
.................... #define RX_3        PIN_E1  
....................  
.................... /*HEADER RS485*/ 
.................... #define TX_4        PIN_C0  //UART4  
.................... #define RX_4        PIN_C1 
.................... #define TX_ENABLE   PIN_H0  //Internal Auxiliar 
.................... #define RX_ENABLE   PIN_H1  //Internal Auxiliar 
....................  
.................... /*USB SERIAL*/ 
.................... #define TX_5        PIN_E2  //UART5 
.................... #define RX_5        PIN_E3 
....................  
.................... /*DIP SWITCH*/ 
.................... #define ADDR0       PIN_F0 
.................... #define ADDR1       PIN_F1 
.................... #define ADDR2       PIN_F2 
.................... #define ADDR3       PIN_F3 
....................  
.................... #define PIN_SDA     PIN_C4 
.................... #define PIN_SCL     PIN_C3 
....................  
.................... #define GPIO_1      PIN_B0 
.................... #define GPIO_2      PIN_B1 
.................... #define GPIO_3      PIN_E5 
.................... #define GPIO_4      PIN_E4 
....................  
.................... //UART2 
.................... #pin_select U2TX=TX_2 
.................... #pin_select U2RX=RX_2 
....................  
.................... //UART3 
.................... #pin_select U3TX=TX_3 
.................... #pin_select U3RX=RX_3 
....................  
.................... //UART4 
.................... #pin_select U4TX=TX_4 
.................... #pin_select U4RX=RX_4 
....................  
.................... //UART5 
.................... #pin_select U5TX=TX_5 
.................... #pin_select U5RX=RX_5 
....................  
.................... //I2C1 
.................... #pin_select SCL1IN=PIN_SCL 
.................... #pin_select SDA1IN=PIN_SDA 
.................... // 
.................... // 
.................... ////SMT 
.................... #pin_select SMT1SIG = PIN_E7   // SMT1 
.................... #pin_select SMT2SIG = PIN_G7   // SMT2 
....................  
.................... //DEBUG SERIAL 
.................... #use rs232(baud=115200,parity=N,UART5,bits=8,stream=DEBUG,errors) 
....................  
.................... #define protolink_debug_msg(msg) fprintf(DEBUG, msg) 
.................... #define protolink_debug_data(msg,data) fprintf(DEBUG,msg,data) 
....................  
....................  
.................... void protolink_io_init(void) 
.................... { 
....................    // Primero todo como entrada (safe mode) 
....................    set_tris_a(0xFF);   // si no usas A, dejalo asi 
*
00608:  MOVLW  FF
0060A:  MOVWF  F81
....................    set_tris_b(0b11111100);   // B todo entrada, B0 y B1 como salida) 
0060C:  MOVLW  FC
0060E:  MOVWF  F82
....................     
....................    // C: UART1, UART4, I2C 
....................    set_tris_c(0b10111110);   // C7 RX1 in, C6 TX1 out, C1 RX4 in, C0 TX4 out, SCL/SDA in 
00610:  MOVLW  BE
00612:  MOVWF  F83
....................  
....................    // D: salidas ULN2003 + ETH_RST 
....................    set_tris_d(0b01110000);   // D3..D0 out, D7 out, D6..D4 in 
00614:  MOVLW  70
00616:  MOVWF  F84
....................  
....................    // E: UART3, UART5, entradas opto 
....................    set_tris_e(0b11001010);   // E0/E2, E4,E5 out, resto in 
00618:  MOVLW  CA
0061A:  MOVWF  F85
....................  
....................    // F: LEDs + GPIO + ADC_RDY 
....................    set_tris_f(0b11111111);   // all out 
0061C:  MOVLW  FF
0061E:  MOVWF  F86
....................  
....................    // G: UART2 + EEPROM WP 
....................    set_tris_g(0b11111101);   // G1 TX2 out, G2 RX2 in, G7 SMT2 in 
00620:  MOVLW  FD
00622:  MOVWF  F87
....................  
....................    // H: control RS485 
....................    set_tris_h(0b11111100);   // H0/H1 out, resto in 
00624:  MOVLW  FC
00626:  MOVWF  F88
....................     
....................    output_float(PIN_SDA); 
00628:  BSF    F83.4
....................    output_float(PIN_SCL); 
0062A:  BSF    F83.3
0062C:  GOTO   06CA (RETURN)
.................... } 
....................  
.................... #ifdef PROTOLINK_DEFAULT 
....................  
....................  
....................  
.................... /* Protolink Default functions 
....................  * Active define for use in main 
....................  * Interrupts use for counters INT0, INT1 
....................  * SMT1 and SMT use for counters 
....................  * Timer0 config for 1 second, consume in protolink_one_second() 
....................  */ 
.................... // Numero de interrupciones de TIMER0 para ~1 segundo 
.................... // 2.048 ms * 488 ? 999.424 ms 
.................... int16 NInts = 488; 
....................  
.................... // VARIABLES GLOBALES 
.................... int16 C_Ints = 0;   // Contador de interrupciones ocurridas 
.................... int1 Flag = 0;     // Flag que cambia cada ~1 segundo 
....................  
.................... // Ejemplo de uso: hacer algo cada vez que cambie Flag (~1s) 
.................... int1 lastFlag = 0; 
....................  
....................  
....................  
.................... volatile unsigned int32 flow1_smt_pps = 0;   // Pulsos/s medidos por SMT1 
.................... volatile unsigned int32 flow2_smt_pps = 0;   // Pulsos/s medidos por SMT2 
....................  
....................  
.................... // ---- CONTADORES ---- 
.................... volatile unsigned int32 flow1_counter = 0;      // Conteo total por INT0 
.................... volatile unsigned int32 flow2_counter = 0;      // Conteo total por INT1 
....................  
.................... volatile unsigned int32 flow1_pps = 0;          // Pulsos por segundo (INT0) 
.................... volatile unsigned int32 flow2_pps = 0;          // Pulsos por segundo (INT1) 
....................  
.................... #INT_TIMER0 
.................... void TIMER0_isr(void){ 
....................     // Incrementamos primero 
....................     C_Ints++; 
....................  
....................     if(C_Ints >= NInts) 
....................     { 
....................         C_Ints = 0; 
....................         Flag = !Flag;   // Toggle cada ~1s 
....................          
.................... //        static unsigned int32 last1 = 0; 
.................... //        static unsigned int32 last2 = 0; 
.................... //        unsigned int32 c1 = flow1_counter; 
.................... //        unsigned int32 c2 = flow2_counter; 
.................... //        flow1_pps = c1 - last1; 
.................... //        flow2_pps = c2 - last2; 
.................... //        last1 = c1; 
.................... //        last2 = c2; 
.................... //         
.................... //         // --- SMT1 / SMT2 --- 
.................... //        static unsigned int32 smt1_last = 0; 
.................... //        static unsigned int32 smt2_last = 0; 
.................... // 
.................... //        unsigned int32 smt1_now = smt1_read(SMT_TMR_REG); 
.................... //        unsigned int32 smt2_now = smt2_read(SMT_TMR_REG); 
.................... // 
.................... //        flow1_smt_pps = smt1_now - smt1_last; 
.................... //        flow2_smt_pps = smt2_now - smt2_last; 
.................... // 
.................... //        smt1_last = smt1_now; 
.................... //        smt2_last = smt2_now; 
....................     } 
....................     clear_interrupt(INT_TIMER0); 
....................      
....................  
.................... } 
....................  
.................... //// ---- ISR INTERRUPCIONES EXTERNAS ---- 
.................... //#INT_EXT            // INT0 
.................... //void isr_int0(void) 
.................... //{ 
.................... //   flow1_counter++; 
.................... //} 
.................... // 
.................... //#INT_EXT1           // INT1 
.................... //void isr_int1(void) 
.................... //{ 
.................... //   flow2_counter++; 
.................... //} 
....................  
.................... //Init default timer 0 for 1 second 
.................... void protolink_timer0_init(void){ 
....................     // Timer0 interno, 8 bits, prescaler 1:128 
....................     // (Las etiquetas pueden ser T0_* o RTCC_* segun version CCS) 
....................     setup_timer_0(T0_INTERNAL | T0_DIV_128 | T0_8_BIT); 
....................  
....................     C_Ints = 0; 
....................     Flag = 0; 
....................  
....................     clear_interrupt(INT_TIMER0); 
....................     enable_interrupts(INT_TIMER0); 
....................     enable_interrupts(GLOBAL); 
....................     set_timer0(0); 
....................      
.................... } 
.................... //Init default Interrupts for protolink 
.................... void protolink_interrupts_init(void){ 
....................     // INT0 en flanco de subida 
....................     ext_int_edge(0, L_TO_H); 
....................  
....................     // INT1 en flanco de subida 
....................     ext_int_edge(1, L_TO_H); 
....................  
....................     clear_interrupt(INT_EXT); 
....................     clear_interrupt(INT_EXT1); 
....................  
....................     enable_interrupts(INT_EXT); 
....................     enable_interrupts(INT_EXT1); 
....................      
.................... } 
....................  
.................... //void protolink_smt_init(void) 
.................... //{ 
.................... // 
.................... // 
.................... //   // ---- SMT1 como contador de pulsos en FLOW1_PIN (INT0) ---- 
.................... //   
.................... //   setup_smt1( 
.................... //           SMT_ENABLED  
.................... //           | SMT_TMR_ROLLSOVER          // 0, opcional, lo dejamos "por claridad" 
.................... //           | SMT_SIG_ACTIVE_HIGH        // 0, se�al activa en alto 
.................... //           | SMT_TMR_INCREMENTS_ON_RE   // 0, flanco de subida 
.................... //           | SMT_DIV_BY_1               // 0 
.................... //           | SMT_REPEAT_DATA_ACQ_MODE   // 0x4000, adquisici�n continua 
.................... //           | SMT_MODE_COUNTER           // 0x0800, modo contador 
.................... //           | SMT_CLK_FOSC_DIV_4         // 0, vale para tenerlo expl�cito 
.................... //           | SMT_START_NOW              // arranca inmediatamente 
.................... //           ); 
.................... //   smt1_reset_timer();                     // contador = 0 
.................... // 
.................... //   // ---- SMT2 como contador de pulsos en FLOW2_PIN (INT1) ---- 
.................... //    
.................... //   setup_smt2( 
.................... //           SMT_ENABLED  
.................... //           | SMT_TMR_ROLLSOVER          // 0, opcional, lo dejamos "por claridad" 
.................... //           | SMT_SIG_ACTIVE_HIGH        // 0, se�al activa en alto 
.................... //           | SMT_TMR_INCREMENTS_ON_RE   // 0, flanco de subida 
.................... //           | SMT_DIV_BY_1               // 0 
.................... //           | SMT_REPEAT_DATA_ACQ_MODE   // 0x4000, adquisici�n continua 
.................... //           | SMT_MODE_COUNTER           // 0x0800, modo contador 
.................... //           | SMT_CLK_FOSC_DIV_4         // 0, vale para tenerlo expl�cito 
.................... //           | SMT_START_NOW              // arranca inmediatamente 
.................... //           ); 
.................... //   smt2_reset_timer(); 
.................... //} 
.................... int1 protolink_one_second(void){ 
....................     if(Flag != lastFlag){ 
....................         lastFlag = flag; 
....................         return true; 
....................     } 
....................     return false; 
.................... } 
.................... #endif 
.................... #define LOADER_END   0x5FF  //ajuste de memoria para protolink v2 bootloader 
.................... #endif	/* PROTOLINK_H */ 
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
*
006A6:  CLRF   05
006A8:  CLRF   06
006AA:  MOVLW  00
006AC:  MOVLB  F
006AE:  MOVWF  x58
006B0:  MOVLB  E
006B2:  MOVWF  x92
006B4:  MOVWF  x9A
006B6:  MOVWF  xA7
006B8:  MOVWF  xAF
006BA:  MOVWF  xB4
006BC:  MOVWF  xBC
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
....................  
*
00630:  BSF    F77.7
00632:  BCF    F77.6
00634:  CLRF   FF8
00636:  BCF    FF2.5
00638:  MOVLB  E
0063A:  MOVLW  55
0063C:  MOVLB  D
0063E:  MOVWF  xEF
00640:  MOVLW  AA
00642:  MOVWF  xEF
00644:  BCF    xEF.0
00646:  MOVLW  27
00648:  MOVLB  E
0064A:  MOVWF  x08
0064C:  MOVLW  37
0064E:  MOVWF  x0A
00650:  MOVLW  32
00652:  MOVWF  x11
00654:  MOVLW  21
00656:  MOVWF  x13
00658:  MOVLW  11
0065A:  MOVWF  x15
0065C:  MOVLW  23
0065E:  MOVWF  x17
00660:  MOVLW  13
00662:  MOVWF  x19
00664:  MOVLW  14
00666:  MOVWF  x1A
00668:  MOVLW  12
0066A:  MOVWF  x62
0066C:  MOVLW  10
0066E:  MOVWF  x72
00670:  MOVLW  14
00672:  MOVWF  x74
00674:  MOVLW  0E
00676:  MOVWF  x83
00678:  MOVLW  55
0067A:  MOVLB  D
0067C:  MOVWF  xEF
0067E:  MOVLW  AA
00680:  MOVWF  xEF
00682:  BSF    xEF.0
00684:  MOVLB  E
00686:  CLRF   x48
00688:  CLRF   x45
0068A:  CLRF   x47
0068C:  CLRF   x49
0068E:  MOVLW  20
00690:  MOVWF  x43
00692:  CLRF   04
00694:  BSF    xE2.3
00696:  MOVLW  8A
00698:  MOVWF  xDE
0069A:  MOVLW  00
0069C:  MOVWF  xDF
0069E:  MOVLW  A6
006A0:  MOVWF  xE1
006A2:  MOVLW  90
006A4:  MOVWF  xE0
*
006BE:  CLRF   xD2
006C0:  CLRF   xD3
006C2:  CLRF   xD1
006C4:  CLRF   xD0
....................  
006C6:  MOVLB  0
006C8:  BRA    0608
....................  
006CA:  BRA    06CA
....................  
....................  
....................  
....................  
006CC:  BRA    06CC

Configuration Fuses:
   Word  1: FFAA   HS RSTOSC_EXT_PLL NOCLKOUT CKS FCMEN
   Word  2: CF3F   MCLR NOPUT NOLPBOR NOBROWNOUT BORV24 ZCDDIS PPS1WAY NOSTVREN DEBUG NOXINST
   Word  3: FF9F   WDTSW NOWDT WDTWIN_SW WDTCLK_SW
   Word  4: DFFF   NOWRT NOWRTC NOWRTB NOWRTD SCANE NOLVP
   Word  5: FFFF   NOPROTECT NOCPD
   Word  6: FFFF   NOEBTR NOEBTRB

   Some fuses have been forced to be compatible with the ICD debugger.
